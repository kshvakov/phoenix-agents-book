<!DOCTYPE html>
<html lang="{{ .Language.Lang }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    {{- $desc := "" -}}
    {{- if .Params.description -}}
        {{- $desc = .Params.description -}}
    {{- else if .Description -}}
        {{- $desc = .Description -}}
    {{- else if .Summary -}}
        {{- $desc = .Summary -}}
    {{- else if .Site.Params.description -}}
        {{- $desc = .Site.Params.description -}}
    {{- end -}}
    <meta name="description" content="{{ $desc | plainify | truncate 160 }}">

    {{ if .Site.Params.yandex_verification }}
    <meta name="yandex-verification" content="{{ .Site.Params.yandex_verification }}" />
    {{ end }}
    {{ if .Site.Params.google_verification }}
    <meta name="google-site-verification" content="{{ .Site.Params.google_verification }}" />
    {{ end }}

    {{- $gaID := .Site.Params.google_analytics_id | default "G-42YNTP8CJM" -}}
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id={{ $gaID }}"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', '{{ $gaID }}');
    </script>

    <title>{{ if and .Title (not .IsHome) }}{{ .Title }} — {{ end }}{{ .Site.Title }}</title>

    <link rel="icon" type="image/svg+xml" href="{{ "favicon.svg" | relURL }}">
    <link rel="stylesheet" href="{{ "assets/site.css" | relURL }}">

    <link rel="canonical" href="{{ .Permalink }}">

    {{ range .AllTranslations }}
    <link rel="alternate" hreflang="{{ .Language.Lang }}" href="{{ .Permalink }}">
    {{ end }}
    <link rel="alternate" hreflang="x-default" href="{{ .Sites.Default.Home.Permalink }}">

    <meta property="og:type" content="{{ if .IsPage }}article{{ else }}website{{ end }}">
    <meta property="og:title" content="{{ if and .Title (not .IsHome) }}{{ .Title }} — {{ end }}{{ .Site.Title }}">
    <meta property="og:description" content="{{ $desc | plainify | truncate 160 }}">
    <meta property="og:url" content="{{ .Permalink }}">

    {{ block "head" . }}{{ end }}
</head>
<body>
    {{ if .IsPage }}
    <div class="reading-progress">
        <div class="reading-progress__bar"></div>
    </div>
    <button class="scroll-to-top" aria-label="{{ if eq .Language.Lang "ru" }}Наверх{{ else }}Scroll to top{{ end }}">
        <span class="scroll-to-top__icon">↑</span>
    </button>
    {{ end }}

    <div class="container">
        <header>
            <h1>
                <a href="/" style="text-decoration: none; color: inherit;">
                    <span class="site-title">
                        <span class="site-title__name">{{ .Site.Params.headerTitle | default "Кирилл Шваков" }}</span>
                        <span class="site-title__subtitle">{{ .Site.Title }}</span>
                    </span>
                </a>
            </h1>
            <div class="header-controls">
                <button id="theme-toggle" class="theme-btn" aria-label="Toggle theme">
                    <span class="theme-icon">☀</span>
                </button>
                <div class="lang-switcher">
                    {{- range .Sites -}}
                        {{- $lang := .Language.Lang -}}
                        {{- $isActive := eq $lang $.Site.Language.Lang -}}
                        {{- $url := "/" -}}
                        {{- if eq $lang "en" -}}
                            {{- $url = "/en/" -}}
                        {{- end -}}
                        <a class="lang-btn{{ if $isActive }} active{{ end }}"
                           href="{{ $url }}"
                           lang="{{ $lang }}"
                           hreflang="{{ $lang }}"
                           {{ if $isActive }}aria-current="page"{{ end }}>{{ .Language.LanguageName }}</a>
                    {{- end -}}
                </div>
            </div>
        </header>

        <main>
            {{ block "main" . }}{{ end }}
        </main>
    </div>

    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Book",
      "name": "{{ .Site.Title }}",
      "description": "{{ $desc | plainify | truncate 300 }}",
      "url": "{{ .Site.BaseURL }}",
      "inLanguage": "{{ .Language.Lang }}"
    }
    </script>

    <script src="{{ "assets/site.js" | relURL }}"></script>
    {{ if .Site.Params.metrika_id }}
    <!-- Yandex.Metrika counter -->
    <script type="text/javascript">
        (function(m,e,t,r,i,k,a){
            m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
            m[i].l=1*new Date();
            for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
            k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
        })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id={{ .Site.Params.metrika_id }}', 'ym');

        ym({{ .Site.Params.metrika_id }}, 'init', {ssr:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
    </script>
    <noscript><div><img src="https://mc.yandex.ru/watch/{{ .Site.Params.metrika_id }}" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
    <!-- /Yandex.Metrika counter -->
    {{ end }}
</body>
</html>

